<% content_for :title, "Sucursales de #{@barbershop.name}" %>

<div class="container-fluid py-4">
  <!-- Header con título y botón -->
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h1 class="h3 mb-2 text-gray-800">
        <i class="fas fa-store text-primary me-2"></i>
        Listado - Sucursales
      </h1>
      <p class="text-muted mb-0">Gestiona todas las sucursales de tu barbería</p>
    </div>
    <%= link_to new_barbershop_branch_path(@barbershop), class: "btn btn-primary btn-lg shadow-sm" do %>
      <i class="fas fa-plus me-2"></i>Nueva Sucursal
    <% end %>
  </div>

  <% if @branches.any? %>
    <!-- Grid de sucursales -->
    <div class="row g-4">
      <% @branches.each do |branch| %>
        <div class="col-xl-4 col-lg-6 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100 hover-lift">
            <div class="card-body p-4">
              <!-- Header de la tarjeta -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="flex-grow-1">
                  <h5 class="card-title text-dark mb-1 fw-bold"><%= branch.name %></h5>
                  <span class="badge bg-success-soft text-success">
                    <i class="fas fa-check-circle me-1"></i>Activa
                  </span>
                </div>
                <div class="dropdown">
                  <button class="btn btn-light btn-sm" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <%= link_to barbershop_branch_path(@barbershop, branch), class: "dropdown-item" do %>
                        <i class="fas fa-eye me-2"></i>Ver detalles
                      <% end %>
                    </li>
                    <li>
                      <%= link_to edit_barbershop_branch_path(@barbershop, branch), class: "dropdown-item" do %>
                        <i class="fas fa-edit me-2"></i>Editar
                      <% end %>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <%= link_to barbershop_branch_path(@barbershop, branch), 
                          method: :delete, 
                          data: { 
                            confirm: "¿Estás seguro de eliminar '#{branch.name}'? Esta acción no se puede deshacer." 
                          }, 
                          class: "dropdown-item text-danger" do %>
                        <i class="fas fa-trash me-2"></i>Eliminar
                      <% end %>
                    </li>
                  </ul>
                </div>
              </div>

              <!-- Información de la sucursal -->
              <div class="mb-4">
                <div class="d-flex align-items-center mb-2">
                  <i class="fas fa-map-marker-alt text-primary me-3"></i>
                  <span class="text-muted small"><%= branch.address %></span>
                </div>
                <div class="d-flex align-items-center mb-2">
                  <i class="fas fa-phone text-primary me-3"></i>
                  <span class="text-muted small"><%= branch.phone %></span>
                </div>
              </div>

              <!-- Stats rápidas -->
              <div class="row text-center border-top pt-3">
                <div class="col-4">
                  <div class="small text-muted">Barberos</div>
                  <div class="fw-bold text-primary"><%= branch.barbers.count %></div>
                </div>
                <div class="col-4">
                  <div class="small text-muted">Tratamientos</div>
                  <div class="fw-bold text-success"><%= branch.treatments.count %></div>
                </div>
                <div class="col-4">
                  <div class="small text-muted">Turnos Hoy</div>
                  <div class="fw-bold text-warning">
                    <%= branch.appointments.where(start_time: Date.current.beginning_of_day..Date.current.end_of_day).count %>
                  </div>
                </div>
              </div>

              <!-- Botón de acción principal -->
              <div class="mt-3">
                <%= link_to barbershop_branch_path(@barbershop, branch), 
                    class: "btn btn-outline-primary w-100" do %>
                  <i class="fas fa-eye me-2"></i>Ver Sucursal
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Paginación -->
    <% if respond_to?(:paginate) && @branches.respond_to?(:current_page) %>
      <div class="d-flex justify-content-center mt-5">
        <%= paginate @branches %>
      </div>
    <% end %>

  <% else %>
    <!-- Estado vacío -->
    <div class="row justify-content-center">
      <div class="col-lg-8 col-xl-6">
        <div class="card border-0 shadow-sm">
          <div class="card-body text-center py-5">
            <div class="mb-4">
              <i class="fas fa-store fa-4x text-muted opacity-50"></i>
            </div>
            <h4 class="text-gray-800 mb-3">No hay sucursales registradas</h4>
            <p class="text-muted mb-4">
              Comienza creando tu primera sucursal. Podrás gestionar barberos, 
              tratamientos y citas desde cada sucursal.
            </p>
            <%= link_to new_barbershop_branch_path(@barbershop), 
                class: "btn btn-primary btn-lg shadow-sm" do %>
              <i class="fas fa-plus me-2"></i>Crear Primera Sucursal
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Features destacadas -->
    <div class="row mt-5">
      <div class="col-lg-4">
        <div class="text-center p-4">
          <div class="bg-primary-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
            <i class="fas fa-users text-primary fa-lg"></i>
          </div>
          <h6 class="fw-bold">Gestión de Barberos</h6>
          <p class="text-muted small mb-0">Asigna barberos a cada sucursal y controla sus horarios</p>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="text-center p-4">
          <div class="bg-success-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
            <i class="fas fa-cut text-success fa-lg"></i>
          </div>
          <h6 class="fw-bold">Servicios Personalizados</h6>
          <p class="text-muted small mb-0">Configura tratamientos específicos para cada ubicación</p>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="text-center p-4">
          <div class="bg-warning-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
            <i class="fas fa-calendar-alt text-warning fa-lg"></i>
          </div>
          <h6 class="fw-bold">Agenda Centralizada</h6>
          <p class="text-muted small mb-0">Visualiza y gestiona todas las citas desde un solo lugar</p>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- CSS adicional -->
<style>
  .hover-lift:hover {
    transform: translateY(-5px);
    transition: transform 0.2s ease-in-out;
  }
  
  .bg-success-soft {
    background-color: rgba(25, 135, 84, 0.1);
  }
  
  .bg-primary-soft {
    background-color: rgba(13, 110, 253, 0.1);
  }
  
  .bg-warning-soft {
    background-color: rgba(255, 193, 7, 0.1);
  }
  
  .card {
    border-radius: 12px;
  }
  
  .btn {
    border-radius: 8px;
  }
  
  .badge {
    border-radius: 6px;
    font-size: 0.75rem;
  }
</style>